
# 消息队列

## 前言
> 一切文章面向实际解决问题，假大空的原理并不适合业务的落地。 任何一个MQ都有其优点和缺点，我们选择最适合我们业务场景的技术才是真正的解决问题

概念和使用问题可以自行百度查看

在使用之前我们要思考以下几个问题，
- 消息队列是什么？
- 为什么要使用消息队列？
- 消息队列都有什么优缺点？
- 不同的消息队列适合那种场景？


 常见三大MQ：
 - ZeroMQ
 - RabbitMQ
 - Kafka

## 几大消息队列的基本对比
|       | ZeroMQ                                                           | RabbitMQ                               | Kafka                                          |
|-------|------------------------------------------------------------------|----------------------------------------|------------------------------------------------|
| 单机吞吐量 | 100万级，低延迟                                                        | 万级，支持高吞吐                               | 10万级，搞吞吐，一般适合大数据系统进行实时数据计算、日志采集等场景             |
| 时效性   | ms级                                                              | ms级                                    | 延迟在 ms 级以内                                     |
| 消息可靠性 | 消息只管发送                                                           | 基本不丢                                   | 经过参数优化配置，可以做到 0 丢失。支持事务                        |
| 消息持久化 | 不支持                                                              | 支持                                     | 支持                                             |
| 消息模式  | 提供多种消息传递模式，如请求-应答、发布-订阅和推送-拉取模式                                  | RabbitMQ 支持多种消息模式，包括点对点、发布-订阅和请求-响应模式  | 发布-订阅模型，支持批量消费和流处理                             |
| 适用场景  | 适用于高吞吐量的异步通信、分布式系统和并发应用                                          | 适用于中等吞吐量的消息通信、任务队列和发布-订阅场景             | 适用于构建实时数据管道、流处理和大规模数据处理应用                      |
| 优点    | 高性能和低延迟；多种消息传递模式；异步通信和并发应用；轻量级和简单易用；可以集成到应用程序中跟项目进程一起执行，不需要额外的安装 | 多种消息模式和消息确认模式；可靠性和持久性；中等吞吐量的消息通信；任务队列模式 | 高吞吐量和低延迟；分布式存储和分区机制；可靠性和持久性；实时数据管道和流处理；大规模数据处理 |
| 缺点    | 不适合大规模数据处理；不支持持久化和数据复制；需要开发者自行处理消息传递的可靠性和一致性                     | 吞吐量相对较低；不适合大规模数据处理                     | 适用于大规模场景，不适合小规模应用；依赖 ZooKeeper 进行协调和管理                             |


## 我选择使用ZeroMQ的场景： ZeroMQ.js

- 首先作为Node.js开发人员，当我们在跟硬件传感器需要进行通讯的时候，并将数据传给nodejs服务接收，其中硬件方采用C++语言实现，此时需要实现c++和nodejs之间低延迟、高吞吐的跨平台消息传递通讯功能。并且不需要安装和运行一个消息服务器或中间件，简单易用保证轻量级，可以跟随项目进程一起启动使用。调研发现RabbitMQ和Kafka它们太沉重了，并且需要额外的安装维护才可以使用，故选用了ZeroMQ，其中不仅满足我们的需求，还号称最快的消息队列系统，还提供了`ZeroMQ.js`库专供Node.js使用。

## 我选择使用RabbitMQ的场景: AMQP、amqplib

-  以上两个包都是RabbitMQ在Nodejs应用中使用的npm库，当然还有其他的。RabbitMQ功能齐全，被称为新一代企业级常用的消息中间件，主要用于应用解耦（例如商城业务场景中，订单系统与库存系统，下单的同步可能也要减去库存，将原本耦合在一块的逻辑可以通过消息队列进行，订单系统发布消息，库存系统订阅消息，这样的好处是一般库存系统出现问题也不会影响到订单系统）、流量削峰（流量削峰在一些营销活动、秒杀场景中应用还是比较广泛的，如果短时间流量过大，可以设置阀值丢弃一部分消息或者根据服务的承受能力设置处理消息的限制，也就是限流。）、异步通讯（在项目中对于一些没必要同步处理的，可以进行异步处理，例如，我们短信发送就是通过MQ队列实现的）。适用于对数据持久性和可靠性有要求的业务系统场景，支持分布式，具有可扩展性，跨平台等特性，并且技术开源基于erlang实现。

## 我选择使用Kafka的场景
  
- 同样Kafka同样具有RabbitMQ的基本功能，但是被设计初衷是用于处理大规模的数据流和实时数据传输，其数据传输的可靠性和一致性需要使用者主动去维护。目前还应用于日志记录相关处理，并且技术非常成熟。

